!function(t,e,a,n){function o(e,a){r=this,this.element=e,c=c=t.extend({},s,a),this._defaults=s,this._name=i,t.inArray(c.dragDirection,d)<0&&(c.dragDirection=s.dragDirection),this.init()}var r,i="threeSixty",s={dragDirection:"horizontal",useKeys:!1,draggable:!0},d=["horizontal","vertical"],c={},u={},l=[],h=0;t.fn.destroy=o.prototype.destroy=function(){c.useKeys===!0&&t(a).unbind("keydown",this.onKeyDown),t(this).removeData(),u.html("")},t.fn.nextFrame=o.prototype.nextFrame=function(){t(this).each(function(e){var a=t(this),n=a.data("lastVal")||0,o=a.data("count");n+=1,a.data("lastVal",n),n>=o?n%=o-1:-o>=n&&(n%=o-1),n>0&&(n=o-n),n=Math.abs(n),a.find(".threesixty-frame").css({display:"none"}),a.find(".threesixty-frame:eq("+n+")").css({display:"block"})})},t.fn.prevFrame=o.prototype.prevFrame=function(){t(this).each(function(e){var a=t(this),n=a.data("lastVal")||0,o=a.data("count");n-=1,a.data("lastVal",n),n>=o?n%=o-1:-o>=n&&(n%=o-1),n>0&&(n=o-n),n=Math.abs(n),a.find(".threesixty-frame").css({display:"none"}),a.find(".threesixty-frame:eq("+n+")").css({display:"block"})})},o.prototype.init=function(){var e=t(this.element);u=e,e.each(function(){var e=t(this),a=e.data("path"),n=e.data("count");l.push({path:a,count:n,loaded:0,$el:e}),h+=n}),x(),this.initLoad()},o.prototype.initLoad=function(){var e,a,n=0,o=l.length;for(u.addClass("preloading"),n;o>n;n++)for(a=0;a<l[n].count;a++)e=l[n].path.replace("{index}",a),t("<img/>").data("index",n).attr("src",e).load(this.onLoadComplete)},o.prototype.onLoadComplete=function(e){var a=t(e.currentTarget).data("index"),n=l[a];n.loaded++,n.loaded===n.count&&r.onLoadAllComplete(a)},o.prototype.onLoadAllComplete=function(t){var e=l[t].$el,a="",n=l[t].count,o=l[t].path,r=0;for(e.html(""),e.removeClass("preloading"),r;n>r;r++){var i=0===r?"block":"none";a+='<img class="threesixty-frame" style="display:'+i+';" data-index="'+r+'" src="'+o.replace("{index}",r)+'"/>'}e.html(a),this.attachHandlers(t)};var p=0,f=0,y=null,v=0,m=0,g=0,b=!1;o.prototype.attachHandlers=function(e){var n=this,o=l[e].$el;if(c.draggable&&"undefined"!=typeof a.ontouchstart&&"undefined"!=typeof a.ontouchmove&&"undefined"!=typeof a.ontouchend&&"undefined"!=typeof a.ontouchcancel){var r=o.get()[0];r.addEventListener("touchstart",n.onTouchStart),r.addEventListener("touchmove",n.onTouchMove),r.addEventListener("touchend",n.onTouchEnd),r.addEventListener("touchcancel",n.onTouchEnd)}o.mousedown(function(e){e.preventDefault(),f=t(this).data("count"),y=t(this),p=e.screenY,g=y.data("lastVal")||0,m=y.data("lastX")||0,v=y.data("lastY")||0,b=!0,y.trigger("down")}),c.useKeys===!0&&t(a).bind("keydown",n.onKeyDown),t(a,"html","body").mouseup(n.onMouseUp),t(a).blur(n.onMouseUp),t("body").mousemove(function(t){n.onMove(t.screenX,t.screenY)})},o.prototype.onTouchStart=function(e){var a=e.touches[0];e.preventDefault(),y=t(e.target).parent(),f=y.data("count"),startX=a.pageX,p=a.pageY,g=y.data("lastVal")||0,m=y.data("lastX")||0,v=y.data("lastY")||0,b=!0,y.trigger("down")},o.prototype.onTouchMove=function(t){t.preventDefault();var e=t.touches[0];r.onMove(e.pageX,e.pageY)},o.prototype.onTouchEnd=function(t){},o.prototype.onMove=function(t,e){if(b){var a=t,n=e,o=0;if(y.trigger("move"),"vertical"===c.dragDirection)o=n>v?g+1:g-1;else if(a>m)o=g+1;else{if(a===m)return;o=g-1}g=o,v=n,m=a,y.data("lastY",v),y.data("lastX",m),y.data("lastVal",g),o>=f?o%=f-1:-f>=o&&(o%=f-1),o>0&&(o=f-o),o=Math.abs(o),y.find(".threesixty-frame").css({display:"none"}),y.find(".threesixty-frame:eq("+o+")").css({display:"block"})}},o.prototype.onKeyDown=function(t){switch(t.keyCode){case 37:u.prevFrame();break;case 39:u.nextFrame()}},o.prototype.onMouseUp=function(t){b=!1,y.trigger("up")};var x=function(){a.body.onselectstart=function(){return!1},a.body.ondragstart=function(){return!1}};t.fn[i]=function(e){return this.each(function(){t.data(this,"plugin_"+i)||t.data(this,"plugin_"+i,new o(this,e))})}}(jQuery,window,document);